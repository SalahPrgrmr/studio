{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Eye of Certainty platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "userName": {
          "type": "string",
          "description": "The user's username."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "creationDate": {
          "type": "string",
          "description": "The date and time the user was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userName",
        "email",
        "creationDate"
      ]
    },
    "CommunityForumPost": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CommunityForumPost",
      "type": "object",
      "description": "Represents a post in the community forum.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CommunityForumPost entity."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the User who created the post. (Relationship: User 1:N CommunityForumPost)"
        },
        "title": {
          "type": "string",
          "description": "The title of the forum post."
        },
        "content": {
          "type": "string",
          "description": "The content of the forum post."
        },
        "creationDate": {
          "type": "string",
          "description": "The date and time the post was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "authorId",
        "title",
        "content",
        "creationDate"
      ]
    },
    "SuccessStory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SuccessStory",
      "type": "object",
      "description": "Represents a success story shared on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SuccessStory entity."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the User who shared the success story. (Relationship: User 1:N SuccessStory)"
        },
        "title": {
          "type": "string",
          "description": "The title of the success story."
        },
        "content": {
          "type": "string",
          "description": "The content of the success story."
        },
        "creationDate": {
          "type": "string",
          "description": "The date and time the success story was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "authorId",
        "title",
        "content",
        "creationDate"
      ]
    },
    "CertaintyDefinition": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CertaintyDefinition",
      "type": "object",
      "description": "Represents a definition of certainty or a related concept.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CertaintyDefinition entity."
        },
        "term": {
          "type": "string",
          "description": "The term being defined."
        },
        "definition": {
          "type": "string",
          "description": "The definition of the term."
        },
        "language": {
          "type": "string",
          "description": "The language of the definition."
        }
      },
      "required": [
        "id",
        "term",
        "definition",
        "language"
      ]
    },
    "LiveStream": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LiveStream",
      "type": "object",
      "description": "Represents a live stream event on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LiveStream entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the live stream."
        },
        "description": {
          "type": "string",
          "description": "A description of the live stream content."
        },
        "startTime": {
          "type": "string",
          "description": "The date and time the live stream is scheduled to start.",
          "format": "date-time"
        },
        "hostId": {
          "type": "string",
          "description": "Reference to the User hosting the live stream. (Relationship: User 1:N LiveStream)"
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "startTime",
        "hostId"
      ]
    },
    "VoiceChatRoom": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VoiceChatRoom",
      "type": "object",
      "description": "Represents a voice chat room on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the VoiceChatRoom entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the voice chat room."
        },
        "description": {
          "type": "string",
          "description": "A description of the voice chat room."
        },
        "creationDate": {
          "type": "string",
          "description": "The date and time the voice chat room was created.",
          "format": "date-time"
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to the User who owns the voice chat room. (Relationship: User 1:N VoiceChatRoom)"
        },
        "members": {
          "type": "object"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "creationDate",
        "ownerId"
      ]
    },
    "VideoChatRoom": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VideoChatRoom",
      "type": "object",
      "description": "Represents a video chat room on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the VideoChatRoom entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the video chat room."
        },
        "presenter": {
          "type": "string",
          "description": "The name of the presenter or host."
        },
        "creationDate": {
          "type": "string",
          "description": "The date and time the video chat room was created.",
          "format": "date-time"
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to the User who owns the video chat room."
        },
        "members": {
          "type": "object"
        }
      },
      "required": [
        "id",
        "name",
        "presenter",
        "creationDate",
        "ownerId"
      ]
    },
    "VoiceChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VoiceChatMessage",
      "type": "object",
      "description": "Represents a voice chat message in a voice chat room.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the VoiceChatMessage entity."
        },
        "roomId": {
          "type": "string",
          "description": "Reference to the VoiceChatRoom the message belongs to. (Relationship: VoiceChatRoom 1:N VoiceChatMessage)"
        },
        "senderId": {
          "type": "string",
          "description": "Reference to the User who sent the message. (Relationship: User 1:N VoiceChatMessage)"
        },
        "message": {
          "type": "string",
          "description": "The text content of the voice chat message."
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "roomId",
        "senderId",
        "message",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Access is restricted to the user themselves (path-based ownership).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/community_forum_posts/{postId}",
        "definition": {
          "entityName": "CommunityForumPost",
          "schema": {
            "$ref": "#/backend/entities/CommunityForumPost"
          },
          "description": "Stores community forum posts. Access can be controlled based on the `authorId` and a `status` field (e.g., 'public', 'private').",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier of the forum post."
            }
          ]
        }
      },
      {
        "path": "/success_stories/{storyId}",
        "definition": {
          "entityName": "SuccessStory",
          "schema": {
            "$ref": "#/backend/entities/SuccessStory"
          },
          "description": "Stores success stories.  Access can be controlled based on the `authorId` and a `status` field.",
          "params": [
            {
              "name": "storyId",
              "description": "The unique identifier of the success story."
            }
          ]
        }
      },
      {
        "path": "/certainty_definitions/{definitionId}",
        "definition": {
          "entityName": "CertaintyDefinition",
          "schema": {
            "$ref": "#/backend/entities/CertaintyDefinition"
          },
          "description": "Stores certainty definitions. Read access is generally public. Write access is restricted to admins (DBAC via /roles_admin/{uid}).",
          "params": [
            {
              "name": "definitionId",
              "description": "The unique identifier of the certainty definition."
            }
          ]
        }
      },
      {
        "path": "/live_streams/{streamId}",
        "definition": {
          "entityName": "LiveStream",
          "schema": {
            "$ref": "#/backend/entities/LiveStream"
          },
          "description": "Stores live stream events. Includes denormalized 'members' map for authorization independence.",
          "params": [
            {
              "name": "streamId",
              "description": "The unique identifier of the live stream."
            }
          ]
        }
      },
      {
        "path": "/voice_chat_rooms/{roomId}",
        "definition": {
          "entityName": "VoiceChatRoom",
          "schema": {
            "$ref": "#/backend/entities/VoiceChatRoom"
          },
          "description": "Stores voice chat rooms. Includes denormalized 'members' map for authorization independence.",
          "params": [
            {
              "name": "roomId",
              "description": "The unique identifier of the voice chat room."
            }
          ]
        }
      },
      {
        "path": "/video_chat_rooms/{roomId}",
        "definition": {
          "entityName": "VideoChatRoom",
          "schema": {
            "$ref": "#/backend/entities/VideoChatRoom"
          },
          "description": "Stores video chat rooms.",
          "params": [
            {
              "name": "roomId",
              "description": "The unique identifier of the video chat room."
            }
          ]
        }
      },
      {
        "path": "/voice_chat_rooms/{roomId}/messages/{messageId}",
        "definition": {
          "entityName": "VoiceChatMessage",
          "schema": {
            "$ref": "#/backend/entities/VoiceChatMessage"
          },
          "description": "Stores voice chat messages within a specific room. Includes denormalized 'members' map from the parent room for authorization independence.",
          "params": [
            {
              "name": "roomId",
              "description": "The unique identifier of the voice chat room."
            },
            {
              "name": "messageId",
              "description": "The unique identifier of the voice chat message."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "role",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection used for DBAC (Database-Based Access Control).  Presence of a document indicates admin role.",
          "params": [
            {
              "name": "uid",
              "description": "User ID of the administrator."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to provide a secure and scalable platform for the Eye of Certainty application. It emphasizes authorization independence and clear security rules. The key aspects of the structure are as follows:\n\n1.  **User Data:** User data is stored in `/users/{userId}` using path-based ownership. This allows for simple security rules based on `request.auth.uid == userId`. No denormalization is required here as access is directly tied to the user's ID.\n\n2.  **Community Forum Posts:** Community forum posts are stored in `/community_forum_posts/{postId}`. The `authorId` is stored within each document. List operations can be secured by limiting access to authorized users or making certain posts public based on a `status` field. (e.g., `status: 'public'` or `status: 'private'`).\n\n3.  **Success Stories:** Similar to forum posts, success stories are stored in `/success_stories/{storyId}`. The `authorId` field ensures clear ownership. Again, using a `status` field can control list access for different user roles.\n\n4.  **Certainty Definitions:** Certainty definitions are stored in `/certainty_definitions/{definitionId}`. These are intended as global, read-only data. Write access would be restricted to admin roles (enforced via a separate `/roles_admin/{uid}` collection - DBAC).\n\n5.  **Live Streams:** Live streams are stored in `/live_streams/{streamId}`. The `hostId` field indicates the owner. A `members` map can be added to handle collaborative live streams, with denormalization of this `members` map into each live stream document. This achieves authorization independence.\n\n6.  **Voice Chat Rooms:** Voice chat rooms are stored in `/voice_chat_rooms/{roomId}`. The `ownerId` field indicates the owner. The `members` map is crucial for authorization. Denormalization is applied: the `members` map is copied from the root document into every `/voice_chat_rooms/{roomId}` document to ensure authorization independence.\n\n7.  **Voice Chat Messages:** Voice chat messages are stored in `/voice_chat_rooms/{roomId}/messages/{messageId}`. Critically, the `members` map from the parent `/voice_chat_rooms/{roomId}` document is denormalized into EACH message. This ensures authorization independence: rules do not need to `get()` the parent room to check membership. QAPs are met because listing messages requires membership in the room, enforced by the denormalized `members` map on each message.\n\nThis structure supports the core design principles by:\n\n*   **Authorization Independence:** Achieved through denormalizing the `members` map in Live Streams and Voice Chat Messages, eliminating the need for `get()` calls in security rules.\n*   **Clarity of Intent:** The structure clearly separates user-owned data, collaborative data, and global data, making security rules more readable and maintainable.\n*   **DBAC:** Roles are managed via document existence in the `/roles_admin/{uid}` collection.\n*   **QAPs:** Segregation (different collections for different access needs) and membership models (denormalized `members` maps) enable secure `list` operations.\n*   **Invariants:** Timestamps are included, and ownership is explicitly modeled with `ownerId` and `authorId` fields."
  }
}
    